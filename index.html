<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apt Engineering Work Platform</title>
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f7f9fc;
            color: #333;
            min-height: 100vh;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: #1a3b5d;
            color: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo {
            height: 40px;
            margin-right: 15px;
        }
        h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .module-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .module-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            padding: 25px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        .module-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #1a3b5d;
        }
        .module-title {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #1a3b5d;
        }
        .module-description {
            color: #666;
            line-height: 1.5;
        }
        .module-content {
            display: none;
        }
        .module-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .back-button {
            background: #1a3b5d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .back-button:hover {
            background: #152e4a;
        }
        .module-loading {
            padding: 20px;
            text-align: center;
        }
        .module-error {
            padding: 20px;
            text-align: center;
            color: #e74c3c;
        }
        .error-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        .logo-upload-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border: 1px dashed #ccc;
        }
        .logo-upload-instructions {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .logo-upload-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .logo-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        .logo-primary {
            background: #0066cc;
            color: white;
        }
        .logo-secondary {
            background: #e0e0e0;
            color: #333;
        }
        /* Styles for the iframe container */
        .iframe-container {
            position: relative;
            width: 100%;
            height: 700px; /* Adjust height as needed */
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        .module-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* --- Add Import/Export Styles --- */
        .header-actions {
            margin-left: auto;
            position: relative;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .menu-button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .menu-button:hover {
            background: #0055aa;
        }
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
            display: none;
            min-width: 180px;
        }
        .dropdown-menu.show {
            display: block;
        }
        .dropdown-item {
            display: block;
            width: 100%;
            padding: 10px 15px;
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: #333;
        }
        .dropdown-item:hover {
            background-color: #f0f0f0;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }
        .notification.success {
            background-color: #28a745;
        }
        .notification.error {
            background-color: #dc3545;
        }
        /* --- End Import/Export Styles --- */
        
        /* Login Modal Styles */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .login-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }
        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .login-header h2 {
            color: #1a3b5d;
            margin-bottom: 10px;
        }
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-group label {
            font-weight: 600;
            color: #555;
        }
        .form-group input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .form-group input:focus {
            outline: none;
            border-color: #1a3b5d;
            box-shadow: 0 0 0 2px rgba(26, 59, 93, 0.2);
        }
        .login-btn {
            background: #1a3b5d;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
        }
        .login-btn:hover {
            background: #152e4a;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: 500;
        }
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #0066cc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .logout-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .register-link {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        .register-link a {
            color: #1a3b5d;
            text-decoration: none;
            font-weight: 600;
        }
        .register-link a:hover {
            text-decoration: underline;
        }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
        }
        .password-input-container {
            position: relative;
        }
        .password-input-container input {
            width: 100%;
            padding-right: 40px;
        }
        .admin-override {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #1a3b5d;
        }
        .admin-override-toggle {
            color: #1a3b5d;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .admin-override-fields {
            margin-top: 10px;
            display: none;
        }
        .admin-override-fields.show {
            display: block;
        }
        .change-password-required {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2001;
        }
        
        /* --- Error Reporting Styles --- */
        .error-report-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #e74c3c;
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 999;
            transition: all 0.3s ease;
        }
        .error-report-button:hover {
            background-color: #c0392b;
            transform: scale(1.1);
        }
        .error-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2002;
            display: none;
        }
        .error-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }
        .error-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        .error-header h2 {
            color: #e74c3c;
            margin-bottom: 10px;
        }
        .close-error-modal {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #e74c3c;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .error-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .error-form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .error-form-group label {
            font-weight: 600;
            color: #555;
        }
        .error-form-group input,
        .error-form-group select,
        .error-form-group textarea {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            font-family: inherit;
        }
        .error-form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        .error-form-group input:focus,
        .error-form-group select:focus,
        .error-form-group textarea:focus {
            outline: none;
            border-color: #1a3b5d;
            box-shadow: 0 0 0 2px rgba(26, 59, 93, 0.2);
        }
        .error-submit-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
        }
        .error-submit-btn:hover {
            background: #c0392b;
        }
        .error-list-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .error-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .error-list-title {
            font-weight: 600;
            color: #1a3b5d;
        }
        .error-item {
            background: white;
            border-radius: 5px;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-left: 4px solid #e74c3c;
        }
        .error-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .error-module {
            font-weight: 600;
            color: #1a3b5d;
        }
        .error-date {
            color: #666;
            font-size: 0.8rem;
        }
        .error-category {
            display: inline-block;
            background: #e0e0e0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        .error-description {
            color: #333;
            margin-bottom: 5px;
        }
        .error-status {
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-new {
            color: #e74c3c;
        }
        .status-in-progress {
            color: #f39c12;
        }
        .status-resolved {
            color: #27ae60;
        }
        .toggle-error-list {
            background: transparent;
            border: none;
            color: #1a3b5d;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        .screenshot-preview {
            margin-top: 10px;
            max-width: 100%;
            border-radius: 5px;
            display: none;
        }
        .screenshot-capture-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .screenshot-capture-btn:hover {
            background: #2980b9;
        }
        
        /* --- Admin Error Dashboard Styles --- */
        .error-dashboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2003;
            display: none;
        }
        .error-dashboard-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }
        .error-dashboard-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        .error-dashboard-header h2 {
            color: #1a3b5d;
            margin-bottom: 10px;
        }
        .close-dashboard-modal {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #1a3b5d;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dashboard-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .dashboard-filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .dashboard-filter-group label {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .dashboard-filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .error-dashboard-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .dashboard-error-item {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #e74c3c;
        }
        .dashboard-error-item.resolved {
            border-left-color: #27ae60;
        }
        .dashboard-error-item.in-progress {
            border-left-color: #f39c12;
        }
        .dashboard-error-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: flex-start;
        }
        .dashboard-error-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #1a3b5d;
            margin-right: 15px;
        }
        .dashboard-error-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .dashboard-error-meta span {
            background: #e0e0e0;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        .dashboard-error-description {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .dashboard-error-actions {
            display: flex;
            gap: 10px;
        }
        .status-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .status-btn.new {
            background: #e74c3c;
            color: white;
        }
        .status-btn.in-progress {
            background: #f39c12;
            color: white;
        }
        .status-btn.resolved {
            background: #27ae60;
            color: white;
        }
        .error-count-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        .admin-error-indicator {
            position: relative;
            margin-right: 15px;
        }
        .view-errors-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .view-errors-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        /* --- End Admin Error Dashboard Styles --- */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="login-modal">
        <div class="login-container">
            <div class="login-header">
                <h2>Apt Engineering Login</h2>
                <p>Sign in to access the platform</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="password-input-container">
                        <input type="password" id="password" placeholder="Enter your password">
                        <button type="button" class="password-toggle" onclick="togglePassword('password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="admin-override">
                    <div class="admin-override-toggle" onclick="toggleAdminOverride()">
                        <i class="fas fa-key"></i> Admin Override
                    </div>
                    <div class="admin-override-fields" id="adminOverrideFields">
                        <div class="form-group">
                            <label for="adminPassword">Admin Password</label>
                            <div class="password-input-container">
                                <input type="password" id="adminPassword" placeholder="Enter admin override password">
                                <button type="button" class="password-toggle" onclick="togglePassword('adminPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="login-btn" onclick="login()">Sign In</button>
                
                <div class="register-link">
                    <p>Don't have an account? <a href="#" onclick="showRegisterForm()">Register here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="login-modal" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <h2>Create Account</h2>
                <p>Register for a new account</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="regUsername">Username</label>
                    <input type="text" id="regUsername" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <div class="password-input-container">
                        <input type="password" id="regPassword" placeholder="Create a password">
                        <button type="button" class="password-toggle" onclick="togglePassword('regPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="regFullName">Full Name</label>
                    <input type="text" id="regFullName" placeholder="Your full name">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" placeholder="Your email address">
                </div>
                <div class="form-group">
                    <label for="regRole">Role</label>
                    <select id="regRole" style="padding: 12px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;">
                        <option value="user">Standard User</option>
                        <option value="manager">Manager</option>
                        <option value="admin">Administrator</option>
                    </select>
                </div>
                <button class="login-btn" onclick="register()">Create Account</button>
                
                <div class="register-link">
                    <p>Already have an account? <a href="#" onclick="showLoginForm()">Sign in here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="login-modal" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <h2>Change Password</h2>
                <p>You must change your password to continue</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="currentPassword">Current Password</label>
                    <div class="password-input-container">
                        <input type="password" id="currentPassword" placeholder="Enter current password">
                        <button type="button" class="password-toggle" onclick="togglePassword('currentPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <div class="password-input-container">
                        <input type="password" id="newPassword" placeholder="Enter new password">
                        <button type="button" class="password-toggle" onclick="togglePassword('newPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <div class="password-input-container">
                        <input type="password" id="confirmPassword" placeholder="Confirm new password">
                        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button class="login-btn" onclick="changePassword()">Update Password</button>
            </div>
        </div>
    </div>

    <!-- Error Reporting Modal -->
    <div id="errorModal" class="error-modal">
        <div class="error-container">
            <div class="error-header">
                <h2>Report an Issue</h2>
                <button class="close-error-modal" onclick="closeErrorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="error-form">
                <div class="error-form-group">
                    <label for="errorModule">Module</label>
                    <select id="errorModule" required>
                        <option value="">Select a module</option>
                        <option value="project-board">Project Board</option>
                        <option value="kpi-monitor">KPI Monitor</option>
                        <option value="payroll-manager">Payroll Manager</option>
                        <option value="work-manager">Work Manager</option>
                        <option value="general">General Platform</option>
                    </select>
                </div>
                <div class="error-form-group">
                    <label for="errorCategory">Category</label>
                    <select id="errorCategory" required>
                        <option value="">Select a category</option>
                        <option value="bug">Bug/Error</option>
                        <option value="ui-issue">User Interface Issue</option>
                        <option value="performance">Performance Problem</option>
                        <option value="feature-request">Feature Request</option>
                        <option value="security">Security Concern</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="error-form-group">
                    <label for="errorSeverity">Severity</label>
                    <select id="errorSeverity" required>
                        <option value="">Select severity</option>
                        <option value="low">Low - Minor inconvenience</option>
                        <option value="medium">Medium - Affects functionality</option>
                        <option value="high">High - Critical function broken</option>
                        <option value="critical">Critical - System down/Data loss</option>
                    </select>
                </div>
                <div class="error-form-group">
                    <label for="errorTitle">Title</label>
                    <input type="text" id="errorTitle" placeholder="Brief description of the issue" required>
                </div>
                <div class="error-form-group">
                    <label for="errorDescription">Description</label>
                    <textarea id="errorDescription" placeholder="Please describe the issue in detail. Include steps to reproduce if applicable." required></textarea>
                </div>
                <div class="error-form-group">
                    <label for="errorScreenshot">Screenshot (optional)</label>
                    <input type="file" id="errorScreenshot" accept="image/*" onchange="previewScreenshot()">
                    <button type="button" class="screenshot-capture-btn" onclick="captureScreenshot()">
                        <i class="fas fa-camera"></i> Capture Current Screen
                    </button>
                    <img id="screenshotPreview" class="screenshot-preview" alt="Screenshot preview">
                </div>
                <button class="error-submit-btn" onclick="submitErrorReport()">Submit Report</button>
                
                <button type="button" class="toggle-error-list" onclick="toggleErrorList()">
                    <i class="fas fa-list"></i> View Previously Reported Issues
                </button>
                
                <div class="error-list-container" id="errorListContainer">
                    <div class="error-list-header">
                        <div class="error-list-title">Your Reported Issues</div>
                        <button class="close-error-modal" onclick="toggleErrorList()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="errorList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Error Dashboard Modal -->
    <div id="errorDashboardModal" class="error-dashboard-modal">
        <div class="error-dashboard-container">
            <div class="error-dashboard-header">
                <h2>Error Reports Dashboard</h2>
                <button class="close-dashboard-modal" onclick="closeErrorDashboard()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="dashboard-filters">
                <div class="dashboard-filter-group">
                    <label for="filterStatus">Status</label>
                    <select id="filterStatus" onchange="filterErrorReports()">
                        <option value="all">All Statuses</option>
                        <option value="new">New</option>
                        <option value="in-progress">In Progress</option>
                        <option value="resolved">Resolved</option>
                    </select>
                </div>
                <div class="dashboard-filter-group">
                    <label for="filterModule">Module</label>
                    <select id="filterModule" onchange="filterErrorReports()">
                        <option value="all">All Modules</option>
                        <option value="project-board">Project Board</option>
                        <option value="kpi-monitor">KPI Monitor</option>
                        <option value="payroll-manager">Payroll Manager</option>
                        <option value="work-manager">Work Manager</option>
                        <option value="general">General Platform</option>
                    </select>
                </div>
                <div class="dashboard-filter-group">
                    <label for="filterSeverity">Severity</label>
                    <select id="filterSeverity" onchange="filterErrorReports()">
                        <option value="all">All Severities</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="dashboard-filter-group">
                    <label for="filterUser">Reported By</label>
                    <select id="filterUser" onchange="filterErrorReports()">
                        <option value="all">All Users</option>
                    </select>
                </div>
            </div>
            
            <div class="error-dashboard-list" id="errorDashboardList">
                <!-- Error reports will be populated here -->
            </div>
        </div>
    </div>

    <!-- Floating Error Report Button -->
    <button class="error-report-button" id="errorReportButton" onclick="openErrorModal()">
        <i class="fas fa-bug"></i>
    </button>

    <div class="app-container" id="mainApp" style="display: none;">
        <header>
            <img src="logo/logo.jpg" onerror="this.onerror=null; this.src='https://via.placeholder.com/120x40?text=LOGO';" alt="Apt Engineering Logo" class="logo">
            <h1>Apt Engineering Work Platform</h1>
            <div class="user-info" id="userInfo">
                <div class="user-avatar" id="userAvatar">U</div>
                <div>
                    <div id="userName">User</div>
                    <div id="userRole" style="font-size: 0.8rem; opacity: 0.8;">Role</div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
                <button class="logout-btn" onclick="showChangePasswordModal()" style="margin-left: 10px;">
                    <i class="fas fa-key"></i> Change Password
                </button>
                
                <!-- Admin Error Indicator -->
                <div class="admin-error-indicator" id="adminErrorIndicator" style="display: none;">
                    <button class="view-errors-btn" onclick="openErrorDashboard()">
                        <i class="fas fa-bug"></i> View Errors
                        <span class="error-count-badge" id="errorCountBadge">0</span>
                    </button>
                </div>
            </div>
            <!-- --- Import/Export UI --- -->
            <div class="header-actions">
                <button class="menu-button" id="menuButton">
                    <i class="fas fa-ellipsis-v"></i> Actions
                </button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <button class="dropdown-item" id="exportBtn">
                        <i class="fas fa-file-export"></i> Export All Data
                    </button>
                    <button class="dropdown-item" id="importBtn">
                        <i class="fas fa-file-import"></i> Import All Data
                    </button>
                    <button class="dropdown-item" id="manageUsersBtn" style="display: none;">
                        <i class="fas fa-users-cog"></i> Manage Users
                    </button>
                    <button class="dropdown-item" id="viewErrorReportsBtn">
                        <i class="fas fa-bug"></i> View Error Reports
                    </button>
                </div>
            </div>
            <!-- --- End Import/Export UI --- -->
        </header>

        <!-- --- Notifications --- -->
        <div id="notification" class="notification"></div>
        <!-- --- End Notifications --- -->

        <div id="moduleSelector" class="module-selector">
            <div class="module-card" onclick="loadModule('project-board')">
                <div class="module-icon">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <h2 class="module-title">Project Board</h2>
                <p class="module-description">Manage projects, tasks, and team performance with our comprehensive project management system</p>
            </div>
            <div class="module-card" onclick="loadModule('kpi-monitor')">
                <div class="module-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h2 class="module-title">KPI Monitor</h2>
                <p class="module-description">Track and analyze key performance indicators across all departments and roles</p>
            </div>
            <!-- New Payroll Manager Module -->
            <div class="module-card" onclick="loadModule('payroll-manager')">
                <div class="module-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <h2 class="module-title">Payroll Manager</h2>
                <p class="module-description">Manage employee payroll, deductions, and generate payslips for your workforce</p>
            </div>
            <!-- New Work Manager Module -->
            <div class="module-card" onclick="loadModule('work-manager')">
                <div class="module-icon">
                    <i class="fas fa-tasks"></i>
                </div>
                <h2 class="module-title">Work Manager</h2>
                <p class="module-description">Integrated project and material database system for engineering works management</p>
            </div>
        </div>
        
        <!-- Module content areas will be populated by JavaScript -->
        <div id="project-boardModule" class="module-content"></div>
        <div id="kpi-monitorModule" class="module-content"></div>
        <div id="payroll-managerModule" class="module-content"></div>
        <div id="work-managerModule" class="module-content"></div>

        <div class="logo-upload-container">
            <div class="logo-upload-instructions">
                <i class="fas fa-info-circle" style="font-size: 2rem; color: #0066cc;"></i>
                <div>
                    <h3>Customize Your Company Logo</h3>
                    <p>Replace the placeholder logo with your company logo for a personalized experience</p>
                </div>
            </div>
            <div class="logo-upload-actions">
                <button class="logo-btn logo-primary" onclick="showLogoInstructions()">
                    <i class="fas fa-image"></i> How to Add Your Logo
                </button>
                <button class="logo-btn logo-secondary" onclick="window.open('logo', '_blank')">
                    <i class="fas fa-folder-open"></i> Open Logo Folder
                </button>
            </div>
        </div>
    </div>
    <script>
        // User management system
        const USER_STORAGE_KEY = "apt_engineering_users";
        const CURRENT_USER_KEY = "apt_engineering_current_user";
        const ERROR_REPORTS_KEY = "apt_engineering_error_reports";
        const MASTER_ADMIN_PASSWORD = "AptMaster2024!"; // Master password only available to you
        
        // Default users (for demo purposes)
        const DEFAULT_USERS = [
            { 
                username: "admin", 
                password: "admin123", 
                fullName: "System Administrator", 
                email: "admin@aptengineering.com", 
                role: "admin",
                avatar: "A",
                firstLogin: true,
                passwordChanged: false
            },
            { 
                username: "manager", 
                password: "manager123", 
                fullName: "Project Manager", 
                email: "manager@aptengineering.com", 
                role: "manager",
                avatar: "M",
                firstLogin: true,
                passwordChanged: false
            },
            { 
                username: "user", 
                password: "user123", 
                fullName: "Standard User", 
                email: "user@aptengineering.com", 
                role: "user",
                avatar: "U",
                firstLogin: true,
                passwordChanged: false
            }
        ];
        
        let currentUser = null;
        let currentModule = null;
        let errorCheckInterval = null;
        
        // Initialize user system
        function initUserSystem() {
            // Check if users exist in localStorage, if not create default ones
            let storedUsers = [];
            try {
                const storedData = localStorage.getItem(USER_STORAGE_KEY);
                if (storedData) {
                    storedUsers = JSON.parse(storedData);
                    if (!Array.isArray(storedUsers)) {
                        throw new Error("Stored users data is not an array");
                    }
                }
            } catch (e) {
                console.error("Error parsing stored users:", e);
                storedUsers = [];
            }
            
            if (storedUsers.length === 0) {
                localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(DEFAULT_USERS));
            }
            
            const storedUser = localStorage.getItem(CURRENT_USER_KEY);
            if (storedUser) {
                try {
                    currentUser = JSON.parse(storedUser);
                    if (currentUser.firstLogin) {
                        showChangePasswordModal();
                    } else {
                        showApp();
                    }
                } catch (e) {
                    console.error("Error parsing current user:", e);
                    showLogin();
                }
            } else {
                showLogin();
            }
        }
        
        // Show login form
        function showLogin() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminOverrideFields').classList.remove('show');
            
            // Clear any error check interval
            if (errorCheckInterval) {
                clearInterval(errorCheckInterval);
                errorCheckInterval = null;
            }
        }
        
        // Show register form
        function showRegisterForm() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('registerModal').style.display = 'flex';
            document.getElementById('regUsername').value = '';
            document.getElementById('regPassword').value = '';
            document.getElementById('regFullName').value = '';
            document.getElementById('regEmail').value = '';
            document.getElementById('regRole').value = 'user';
        }
        
        // Show login form from register
        function showLoginForm() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('registerModal').style.display = 'none';
        }
        
        // Toggle admin override fields
        function toggleAdminOverride() {
            document.getElementById('adminOverrideFields').classList.toggle('show');
        }
        
        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggleButton = input.parentNode.querySelector('.password-toggle');
            if (input.type === 'password') {
                input.type = 'text';
                toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                input.type = 'password';
                toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const adminPassword = document.getElementById('adminPassword').value;
            
            if (!username || !password) {
                showNotification('Please enter both username and password', 'error');
                return;
            }
            
            let users = [];
            try {
                users = JSON.parse(localStorage.getItem(USER_STORAGE_KEY)) || [];
            } catch (e) {
                console.error("Error parsing users:", e);
                users = [];
            }
            
            // Check for admin override
            if (adminPassword && adminPassword === MASTER_ADMIN_PASSWORD) {
                // Find the user with admin override
                const user = users.find(u => u.username === username);
                if (user) {
                    currentUser = user;
                    localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
                    showApp();
                    showNotification('Admin override login successful', 'success');
                    return;
                }
            }
            
            // Normal login
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
                
                if (user.firstLogin) {
                    showChangePasswordModal();
                } else {
                    showApp();
                }
                
                showNotification('Login successful', 'success');
            } else {
                showNotification('Invalid username or password', 'error');
            }
        }
        
        // Register function
        function register() {
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const fullName = document.getElementById('regFullName').value;
            const email = document.getElementById('regEmail').value;
            const role = document.getElementById('regRole').value;
            
            if (!username || !password || !fullName || !email) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            let users = [];
            try {
                users = JSON.parse(localStorage.getItem(USER_STORAGE_KEY)) || [];
            } catch (e) {
                console.error("Error parsing users:", e);
                users = [];
            }
            
            // Check if username already exists
            if (users.some(u => u.username === username)) {
                showNotification('Username already exists', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                username,
                password,
                fullName,
                email,
                role,
                avatar: fullName.charAt(0).toUpperCase(),
                firstLogin: true,
                passwordChanged: false
            };
            
            users.push(newUser);
            localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(users));
            
            showNotification('Account created successfully. Please log in.', 'success');
            showLoginForm();
        }
        
        // Show change password modal
        function showChangePasswordModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('changePasswordModal').style.display = 'flex';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        // Change password function
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            let users = [];
            try {
                users = JSON.parse(localStorage.getItem(USER_STORAGE_KEY)) || [];
            } catch (e) {
                console.error("Error parsing users:", e);
                users = [];
            }
            
            // Find current user
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            
            if (userIndex === -1) {
                showNotification('User not found', 'error');
                return;
            }
            
            // Verify current password
            if (users[userIndex].password !== currentPassword) {
                showNotification('Current password is incorrect', 'error');
                return;
            }
            
            // Update password
            users[userIndex].password = newPassword;
            users[userIndex].firstLogin = false;
            users[userIndex].passwordChanged = true;
            
            localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(users));
            
            // Update current user
            currentUser = users[userIndex];
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
            
            showNotification('Password changed successfully', 'success');
            document.getElementById('changePasswordModal').style.display = 'none';
            showApp();
        }
        
        // Logout function
        function logout() {
            localStorage.removeItem(CURRENT_USER_KEY);
            currentUser = null;
            showLogin();
        }
        
        // Show the main application
        function showApp() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Update user info in the header
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            
            // Show/hide admin features based on role
            if (currentUser.role === 'admin') {
                document.getElementById('manageUsersBtn').style.display = 'block';
            } else {
                document.getElementById('manageUsersBtn').style.display = 'none';
            }
            
            // Setup error monitoring for managers and admins
            setupErrorMonitoring();
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // --- Import/Export Functions ---
        document.getElementById('menuButton').addEventListener('click', function() {
            document.getElementById('dropdownMenu').classList.toggle('show');
        });
        
        // Close dropdown when clicking outside
        window.addEventListener('click', function(event) {
            if (!event.target.matches('.menu-button')) {
                const dropdown = document.getElementById('dropdownMenu');
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        });
        
        document.getElementById('exportBtn').addEventListener('click', function() {
            // Get all data from localStorage
            const users = localStorage.getItem(USER_STORAGE_KEY);
            const currentUserData = localStorage.getItem(CURRENT_USER_KEY);
            const errorReports = localStorage.getItem(ERROR_REPORTS_KEY);
            
            // Combine all data
            const exportData = {
                users: users ? JSON.parse(users) : [],
                currentUser: currentUserData ? JSON.parse(currentUserData) : null,
                errorReports: errorReports ? JSON.parse(errorReports) : []
            };
            
            // Create a blob and download link
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `apt_engineering_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully', 'success');
            document.getElementById('dropdownMenu').classList.remove('show');
        });
        
        document.getElementById('importBtn').addEventListener('click', function() {
            // Create file input element
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        // Validate the import data structure
                        if (!importData.users || !Array.isArray(importData.users)) {
                            throw new Error("Invalid data format: users array missing");
                        }
                        
                        // Import the data
                        localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(importData.users));
                        
                        if (importData.currentUser) {
                            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(importData.currentUser));
                            currentUser = importData.currentUser;
                        }
                        
                        if (importData.errorReports && Array.isArray(importData.errorReports)) {
                            localStorage.setItem(ERROR_REPORTS_KEY, JSON.stringify(importData.errorReports));
                        }
                        
                        showNotification('Data imported successfully', 'success');
                        showApp(); // Refresh the app
                    } catch (error) {
                        console.error('Error importing data:', error);
                        showNotification('Failed to import data: Invalid file format', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            fileInput.click();
            document.getElementById('dropdownMenu').classList.remove('show');
        });
        
        // --- Error Reporting System ---
        
        // Setup error monitoring for managers and admins
        function setupErrorMonitoring() {
            const isManagerOrAdmin = currentUser.role === 'manager' || currentUser.role === 'admin';
            
            if (isManagerOrAdmin) {
                // Show the error indicator
                document.getElementById('adminErrorIndicator').style.display = 'block';
                
                // Check for errors immediately
                updateErrorCount();
                
                // Set up interval to check for new errors every 30 seconds
                errorCheckInterval = setInterval(updateErrorCount, 30000);
            } else {
                // Hide the error indicator for non-managers/admins
                document.getElementById('adminErrorIndicator').style.display = 'none';
                
                // Clear any existing interval
                if (errorCheckInterval) {
                    clearInterval(errorCheckInterval);
                    errorCheckInterval = null;
                }
            }
        }
        
        // Update the error count badge
        function updateErrorCount() {
            let errorReports = [];
            try {
                const storedReports = localStorage.getItem(ERROR_REPORTS_KEY);
                if (storedReports) {
                    errorReports = JSON.parse(storedReports);
                }
            } catch (e) {
                console.error("Error parsing error reports:", e);
                errorReports = [];
            }
            
            // Count only new errors
            const newErrorCount = errorReports.filter(report => report.status === 'new').length;
            
            // Update the badge
            const errorCountBadge = document.getElementById('errorCountBadge');
            errorCountBadge.textContent = newErrorCount;
            
            // Add pulse animation if there are new errors
            if (newErrorCount > 0) {
                errorCountBadge.style.animation = 'pulse 2s infinite';
            } else {
                errorCountBadge.style.animation = 'none';
            }
        }
        
        // Open error modal
        function openErrorModal() {
            document.getElementById('errorModal').style.display = 'flex';
            document.getElementById('errorListContainer').style.display = 'none';
            document.getElementById('screenshotPreview').style.display = 'none';
            document.getElementById('screenshotPreview').src = '';
            
            // If we're in a module, pre-select that module
            if (currentModule) {
                document.getElementById('errorModule').value = currentModule;
            }
            
            // Load user's error reports
            loadUserErrorReports();
        }
        
        // Close error modal
        function closeErrorModal() {
            document.getElementById('errorModal').style.display = 'none';
            // Reset form
            document.getElementById('errorForm').reset();
        }
        
        // Toggle error list visibility
        function toggleErrorList() {
            const errorListContainer = document.getElementById('errorListContainer');
            if (errorListContainer.style.display === 'block') {
                errorListContainer.style.display = 'none';
            } else {
                errorListContainer.style.display = 'block';
                loadUserErrorReports();
            }
        }
        
        // Load user's error reports
        function loadUserErrorReports() {
            const errorList = document.getElementById('errorList');
            errorList.innerHTML = '';
            
            let errorReports = [];
            try {
                const storedReports = localStorage.getItem(ERROR_REPORTS_KEY);
                if (storedReports) {
                    errorReports = JSON.parse(storedReports);
                }
            } catch (e) {
                console.error("Error parsing error reports:", e);
                errorReports = [];
            }
            
            // Filter to show only current user's reports
            const userReports = errorReports.filter(report => report.userId === currentUser.username);
            
            if (userReports.length === 0) {
                errorList.innerHTML = '<p>No issues reported yet.</p>';
                return;
            }
            
            // Sort by date (newest first)
            userReports.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            userReports.forEach(report => {
                const errorItem = document.createElement('div');
                errorItem.className = 'error-item';
                
                const date = new Date(report.timestamp).toLocaleString();
                
                errorItem.innerHTML = `
                    <div class="error-item-header">
                        <div class="error-module">${report.module}</div>
                        <div class="error-date">${date}</div>
                    </div>
                    <div class="error-category">${report.category}</div>
                    <div class="error-description">${report.title}</div>
                    <div class="error-status status-${report.status || 'new'}">
                        Status: ${report.status ? report.status.charAt(0).toUpperCase() + report.status.slice(1) : 'New'}
                    </div>
                `;
                
                errorList.appendChild(errorItem);
            });
        }
        
        // Preview screenshot
        function previewScreenshot() {
            const file = document.getElementById('errorScreenshot').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('screenshotPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Capture current screen (simplified version)
        function captureScreenshot() {
            // In a real implementation, this would use a library like html2canvas
            alert("In a full implementation, this would capture the current screen. For this demo, please use the file upload option.");
        }
        
        // Submit error report
        function submitErrorReport() {
            const module = document.getElementById('errorModule').value;
            const category = document.getElementById('errorCategory').value;
            const severity = document.getElementById('errorSeverity').value;
            const title = document.getElementById('errorTitle').value;
            const description = document.getElementById('errorDescription').value;
            const screenshotFile = document.getElementById('errorScreenshot').files[0];
            
            if (!module || !category || !severity || !title || !description) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            let errorReports = [];
            try {
                const storedReports = localStorage.getItem(ERROR_REPORTS_KEY);
                if (storedReports) {
                    errorReports = JSON.parse(storedReports);
                }
            } catch (e) {
                console.error("Error parsing error reports:", e);
                errorReports = [];
            }
            
            // Create new error report
            const newReport = {
                id: Date.now().toString(),
                userId: currentUser.username,
                userFullName: currentUser.fullName,
                module,
                category,
                severity,
                title,
                description,
                timestamp: new Date().toISOString(),
                status: 'new'
            };
            
            // Handle screenshot if provided
            if (screenshotFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newReport.screenshot = e.target.result;
                    saveErrorReport(errorReports, newReport);
                };
                reader.readAsDataURL(screenshotFile);
            } else {
                saveErrorReport(errorReports, newReport);
            }
        }
        
        // Save error report to storage
        function saveErrorReport(errorReports, newReport) {
            errorReports.push(newReport);
            localStorage.setItem(ERROR_REPORTS_KEY, JSON.stringify(errorReports));
            
            showNotification('Issue reported successfully. Thank you!', 'success');
            closeErrorModal();
            
            // Update error count for managers/admins
            updateErrorCount();
            
            // In a real implementation, this would also send the report to a server
            console.log("Error report submitted:", newReport);
        }
        
        // --- Admin Error Dashboard ---
        
        // Open error dashboard
        function openErrorDashboard() {
            document.getElementById('errorDashboardModal').style.display = 'flex';
            loadErrorDashboard();
        }
        
        // Close error dashboard
        function closeErrorDashboard() {
            document.getElementById('errorDashboardModal').style.display = 'none';
        }
        
        // Load error dashboard with all reports
        function loadErrorDashboard() {
            let errorReports = [];
            try {
                const storedReports = localStorage.getItem(ERROR_REPORTS_KEY);
                if (storedReports) {
                    errorReports = JSON.parse(storedReports);
                }
            } catch (e) {
                console.error("Error parsing error reports:", e);
                errorReports = [];
            }
            
            // Populate user filter
            populateUserFilter(errorReports);
            
            // Apply filters and display reports
            filterErrorReports();
        }
        
        // Populate user filter dropdown
        function populateUserFilter(errorReports) {
            const userFilter = document.getElementById('filterUser');
            
            // Clear existing options except "All Users"
            while (userFilter.options.length > 1) {
                userFilter.remove(1);
            }
            
            // Get unique users from error reports
            const users = [...new Set(errorReports.map(report => report.userId))];
            
            // Add each user to the filter
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                userFilter.appendChild(option);
            });
        }
        
        // Filter error reports based on selected filters
        function filterErrorReports() {
            const statusFilter = document.getElementById('filterStatus').value;
            const moduleFilter = document.getElementById('filterModule').value;
            const severityFilter = document.getElementById('filterSeverity').value;
            const userFilter = document.getElementById('filterUser').value;
            
            let errorReports = [];
            try {
                const storedReports = localStorage.getItem(ERROR_REPORTS_KEY);
                if (storedReports) {
                    errorReports = JSON.parse(storedReports);
                }
            } catch (e) {
                console.error("Error parsing error reports:", e);
                errorReports = [];
            }
            
            // Apply filters
            let filteredReports = errorReports.filter(report => {
                if (statusFilter !== 'all' && report.status !== statusFilter) return false;
                if (moduleFilter !== 'all' && report.module !== moduleFilter) return false;
                if (severityFilter !== 'all' && report.severity !== severityFilter) return false;
                if (userFilter !== 'all' && report.userId !== userFilter) return false;
                return true;
            });
            
            // Sort by date (newest first)
            filteredReports.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Display filtered reports
            displayFilteredReports(filteredReports);
        }
        
        // Display filtered reports in the dashboard
        function displayFilteredReports(reports) {
            const dashboardList = document.getElementById('errorDashboardList');
            dashboardList.innerHTML = '';
            
            if (reports.length === 0) {
                dashboardList.innerHTML = '<p>No error reports match the selected filters.</p>';
                return;
            }
            
            reports.forEach(report => {
                const reportItem = document.createElement('div');
                reportItem.className = `dashboard-error-item ${report.status || 'new'}`;
                
                const date = new Date(report.timestamp).toLocaleString();
                
                reportItem.innerHTML = `
                    <div class="dashboard-error-header">
                        <div class="dashboard-error-title">${report.title}</div>
                        <div class="dashboard-error-actions">
                            <button class="status-btn ${report.status || 'new'}" onclick="changeErrorStatus('${report.id}', '${report.status || 'new'}')">
                                ${report.status ? report.status.charAt(0).toUpperCase() + report.status.slice(1) : 'New'}
                            </button>
                        </div>
                    </div>
                    <div class="dashboard-error-meta">
                        <span>Module: ${report.module}</span>
                        <span>Category: ${report.category}</span>
                        <span>Severity: ${report.severity}</span>
                        <span>Reported by: ${report.userFullName} (${report.userId})</span>
                        <span>Date: ${date}</span>
                    </div>
                    <div class="dashboard-error-description">${report.description}</div>
                `;
                
                dashboardList.appendChild(reportItem);
            });
        }
        
        // Change error status
        function changeErrorStatus(errorId, currentStatus) {
            let errorReports = [];
            try {
                const storedReports = localStorage.getItem(ERROR_REPORTS_KEY);
                if (storedReports) {
                    errorReports = JSON.parse(storedReports);
                }
            } catch (e) {
                console.error("Error parsing error reports:", e);
                errorReports = [];
            }
            
            // Find the error report
            const errorIndex = errorReports.findIndex(report => report.id === errorId);
            
            if (errorIndex === -1) {
                showNotification('Error report not found', 'error');
                return;
            }
            
            // Determine new status based on current status
            let newStatus;
            switch (currentStatus) {
                case 'new':
                    newStatus = 'in-progress';
                    break;
                case 'in-progress':
                    newStatus = 'resolved';
                    break;
                case 'resolved':
                    newStatus = 'new';
                    break;
                default:
                    newStatus = 'new';
            }
            
            // Update the status
            errorReports[errorIndex].status = newStatus;
            
            // Save back to storage
            localStorage.setItem(ERROR_REPORTS_KEY, JSON.stringify(errorReports));
            
            // Refresh the dashboard
            filterErrorReports();
            
            // Update the error count badge
            updateErrorCount();
            
            showNotification(`Error status updated to ${newStatus}`, 'success');
        }
        
        // --- Module Loading System ---
        
        // Load a module
        function loadModule(moduleId) {
            currentModule = moduleId;
            
            // Hide all modules
            const modules = document.querySelectorAll('.module-content');
            modules.forEach(module => {
                module.classList.remove('active');
            });
            
            // Hide module selector
            document.getElementById('moduleSelector').style.display = 'none';
            
            // Show back button
            const backButton = document.createElement('button');
            backButton.className = 'back-button';
            backButton.innerHTML = '<i class="fas fa-arrow-left"></i> Back to Modules';
            backButton.onclick = () => {
                document.getElementById(`${moduleId}Module`).innerHTML = '';
                document.getElementById(`${moduleId}Module`).classList.remove('active');
                document.getElementById('moduleSelector').style.display = 'grid';
                currentModule = null;
            };
            
            // Show loading state
            const moduleContent = document.getElementById(`${moduleId}Module`);
            moduleContent.innerHTML = '';
            moduleContent.appendChild(backButton);
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'module-loading';
            loadingDiv.innerHTML = `
                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px;"></i>
                <p>Loading ${moduleId.replace(/-/g, ' ')}...</p>
            `;
            
            moduleContent.appendChild(loadingDiv);
            moduleContent.classList.add('active');
            
            // Simulate module loading
            setTimeout(() => {
                moduleContent.removeChild(loadingDiv);
                
                // Add module-specific content
                const moduleTitle = document.createElement('h2');
                moduleTitle.textContent = moduleId.replace(/-/g, ' ').toUpperCase();
                moduleTitle.style.margin = '20px 0';
                
                const moduleDescription = document.createElement('p');
                moduleDescription.textContent = `This is the ${moduleId.replace(/-/g, ' ')} module. In a full implementation, this would contain the actual module interface.`;
                moduleDescription.style.marginBottom = '20px';
                
                moduleContent.appendChild(moduleTitle);
                moduleContent.appendChild(moduleDescription);
                
                // Add a sample iframe for demonstration
                const iframeContainer = document.createElement('div');
                iframeContainer.className = 'iframe-container';
                
                const iframe = document.createElement('iframe');
                iframe.className = 'module-iframe';
                iframe.src = 'about:blank'; // In a real implementation, this would point to the actual module
                iframe.onload = function() {
                    // Add content to the iframe for demonstration
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    iframeDoc.body.innerHTML = `
                        <div style="padding: 20px; text-align: center;">
                            <h2>${moduleId.replace(/-/g, ' ').toUpperCase()} Module</h2>
                            <p>This would be the actual module interface in a full implementation.</p>
                            <p>You can use the floating "Report Error" button to report any issues with this module.</p>
                        </div>
                    `;
                };
                
                iframeContainer.appendChild(iframe);
                moduleContent.appendChild(iframeContainer);
            }, 1500);
        }
        
        // Show logo instructions
        function showLogoInstructions() {
            alert("To add your company logo:\n\n1. Create a folder named 'logo' in the same directory as this application\n2. Place your logo file (preferably PNG format) named 'logo.jpg' in that folder\n3. Refresh the application\n\nYour logo will automatically replace the placeholder.");
        }
        
        // Initialize the application
        function initApp() {
            initUserSystem();
            
            // Setup menu button functionality
            document.getElementById('menuButton').addEventListener('click', function() {
                document.getElementById('dropdownMenu').classList.toggle('show');
            });
            
            // Close dropdown when clicking outside
            window.addEventListener('click', function(event) {
                if (!event.target.matches('.menu-button')) {
                    const dropdown = document.getElementById('dropdownMenu');
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            });
            
            // Setup error report button
            document.getElementById('errorReportButton').addEventListener('click', openErrorModal);
            
            // Setup view error reports button
            document.getElementById('viewErrorReportsBtn').addEventListener('click', openErrorDashboard);
        }
        
        // Start the application when the page loads
        window.onload = initApp;
    </script>
</body>
</html>